openapi: 3.0.3
info:
  title: PFMS API
  version: 1.0.0

servers:
  - url: http://localhost:8080

tags:
  - name: Authentication
  - name: Categories
  - name: Operations

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    UUID:
      type: string
      format: uuid
      example: "3fa85f64-5717-4562-b3fc-2c963f66afa6"

    Money:
      type: string
      pattern: '^\d+(\.\d{1,2})?$'
      example: "1234.56"

    CategoryKind:
      type: string
      enum: [INCOME, EXPENSE]
      example: EXPENSE

    CredentialsRequestDto:
      type: object
      required: [login, password]
      additionalProperties: false
      properties:
        login:
          type: string
          minLength: 1
          maxLength: 128
          example: "bogdan"
        password:
          type: string
          minLength: 8
          maxLength: 72
          example: "SuperStrongPassword123"

    CreateCategoryRequestDto:
      type: object
      required: [name, kind]
      additionalProperties: false
      properties:
        name:
          type: string
          minLength: 1
          example: "Еда"
        kind:
          $ref: "#/components/schemas/CategoryKind"
        budgetAmount:
          allOf:
            - $ref: "#/components/schemas/Money"
          nullable: true
          example: "15000.00"

    SetBudgetAmountRequestDto:
      type: object
      required: [categoryId, budgetAmount]
      additionalProperties: false
      properties:
        categoryId:
          $ref: "#/components/schemas/UUID"
        budgetAmount:
          $ref: "#/components/schemas/Money"

    CreateOperationRequestDto:
      type: object
      required: [categoryId, amount]
      additionalProperties: false
      properties:
        categoryId:
          $ref: "#/components/schemas/UUID"
        amount:
          $ref: "#/components/schemas/Money"
        description:
          type: string
          nullable: true
          example: "Покупка продуктов"

    CategoryIdsRequest:
      type: array
      minItems: 1
      uniqueItems: true
      items:
        $ref: "#/components/schemas/UUID"
      example:
        - "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"
        - "bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb"

    RegisterResponseDto:
      type: object
      required: [id, login]
      additionalProperties: false
      properties:
        id:
          $ref: "#/components/schemas/UUID"
        login:
          type: string
          example: "bogdan"

    TokenResponseDto:
      type: object
      required: [token, expiresAt]
      additionalProperties: false
      properties:
        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        expiresAt:
          type: string
          format: date-time
          example: "2026-01-14T12:00:00Z"

    CreateCategoryResponseDto:
      type: object
      required: [id, userId, name, kind]
      additionalProperties: false
      properties:
        id:
          $ref: "#/components/schemas/UUID"
        userId:
          $ref: "#/components/schemas/UUID"
        name:
          type: string
          example: "Еда"
        kind:
          $ref: "#/components/schemas/CategoryKind"
        budgetAmount:
          allOf:
            - $ref: "#/components/schemas/Money"
          nullable: true
          example: "15000.00"

    CreateOperationResponseDto:
      type: object
      required: [operation]
      additionalProperties: false
      properties:
        message:
          type: string
          nullable: true
          example: "EXPENSES_EXCEEDED_INCOME"
        operation:
          type: object
          required: [id, categoryId, amount, happenedAt]
          additionalProperties: false
          properties:
            id:
              $ref: "#/components/schemas/UUID"
            categoryId:
              $ref: "#/components/schemas/UUID"
            amount:
              $ref: "#/components/schemas/Money"
            description:
              type: string
              nullable: true
              example: "Покупка продуктов"
            happenedAt:
              type: string
              format: date-time
              example: "2026-01-14T10:15:30Z"

    ErrorResponseDto:
      type: object
      required: [message]
      additionalProperties: false
      properties:
        message:
          type: string
          example: "Категория не найдена"

    ValidationErrorResponseDto:
      type: object
      required: [message, errors]
      additionalProperties: false
      properties:
        message:
          type: string
          example: "Ошибка валидации входных данных"
        errors:
          type: array
          items:
            type: object
            required: [field, message]
            additionalProperties: false
            properties:
              field:
                type: string
                example: "login"
              message:
                type: string
                example: "Поле не должно быть пустым"

    ViewGeneralReportResponseDto:
      type: object
      required: [generalIncome, incomeCategoriesReports, generalExpense, expenseCategoriesReports]
      additionalProperties: false
      properties:
        generalIncome:
          $ref: "#/components/schemas/Money"
        incomeCategoriesReports:
          type: array
          items:
            type: object
            required: [categoryName, incomeAmount]
            additionalProperties: false
            properties:
              categoryName:
                type: string
                example: "Зарплата"
              incomeAmount:
                $ref: "#/components/schemas/Money"
        generalExpense:
          $ref: "#/components/schemas/Money"
        expenseCategoriesReports:
          type: array
          items:
            type: object
            required: [categoryName, budgetAmount, remainingAmount]
            additionalProperties: false
            properties:
              categoryName:
                type: string
                example: "Еда"
              budgetAmount:
                $ref: "#/components/schemas/Money"
              remainingAmount:
                $ref: "#/components/schemas/Money"

    ViewCategoriesReportResponseDto:
      type: object
      required: [incomeCategories, expenseCategories]
      additionalProperties: false
      properties:
        incomeCategories:
          type: array
          items:
            type: object
            required: [categoryName, incomeAmount]
            additionalProperties: false
            properties:
              categoryName:
                type: string
                example: "Зарплата"
              incomeAmount:
                $ref: "#/components/schemas/Money"
        expenseCategories:
          type: array
          items:
            type: object
            required: [categoryName, budgetAmount, remainingAmount]
            additionalProperties: false
            properties:
              categoryName:
                type: string
                example: "Еда"
              budgetAmount:
                $ref: "#/components/schemas/Money"
              remainingAmount:
                $ref: "#/components/schemas/Money"

  responses:
    BadRequestValidation:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ValidationErrorResponseDto"

    BadRequestInvalidBody:
      description: Invalid request body format
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponseDto"

    Conflict:
      description: Conflict
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponseDto"

    NotFound:
      description: Not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponseDto"

    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponseDto"

paths:
  /pfms/authentication/register:
    post:
      tags: [Authentication]
      summary: Register
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CredentialsRequestDto"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegisterResponseDto"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/ValidationErrorResponseDto"
                  - $ref: "#/components/schemas/ErrorResponseDto"
        "409":
          $ref: "#/components/responses/Conflict"

  /pfms/authentication/get-token:
    post:
      tags: [Authentication]
      summary: Get token
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CredentialsRequestDto"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponseDto"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/ValidationErrorResponseDto"
                  - $ref: "#/components/schemas/ErrorResponseDto"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /pfms/categories/create:
    post:
      tags: [Categories]
      summary: Create category
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateCategoryRequestDto"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateCategoryResponseDto"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/ValidationErrorResponseDto"
                  - $ref: "#/components/schemas/ErrorResponseDto"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "409":
          $ref: "#/components/responses/Conflict"

  /pfms/categories/set-budget-amount:
    put:
      tags: [Categories]
      summary: Set budget amount
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SetBudgetAmountRequestDto"
      responses:
        "204":
          description: No Content
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/ValidationErrorResponseDto"
                  - $ref: "#/components/schemas/ErrorResponseDto"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /pfms/categories/view-categories-report:
    post:
      tags: [Categories]
      summary: View categories report
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CategoryIdsRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ViewCategoriesReportResponseDto"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/ValidationErrorResponseDto"
                  - $ref: "#/components/schemas/ErrorResponseDto"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /pfms/operations/create:
    post:
      tags: [Operations]
      summary: Create operation
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateOperationRequestDto"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateOperationResponseDto"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/ValidationErrorResponseDto"
                  - $ref: "#/components/schemas/ErrorResponseDto"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /pfms/operations/view-general-report:
    get:
      tags: [Operations]
      summary: View general report
      security:
        - bearerAuth: []
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ViewGeneralReportResponseDto"
        "401":
          $ref: "#/components/responses/Unauthorized"
